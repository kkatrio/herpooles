<html>
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    </head>
    <body>

        <canvas id="canvas"></canvas>
        <script type="module">
            import init, {draw, Herpooles } from './pkg/fight_the_poo.js';

            // get canvas context
            const canvas = document.getElementById("canvas");
            canvas.width = 1000;
            canvas.height = 800;
            const ctx = canvas.getContext("2d");

            async function run() {
                await init();

                // data
                let herpooles = new Herpooles(500, 500);

                // keyboard events
                let rightPressed = false;
                let leftPressed = false;
                let upPressed = false;
                let downPressed = false;
                const KeyboardHelper = { left: 37, up: 38, right: 39, down: 40 };
                document.addEventListener("keydown", () => {
                        if (event.keyCode === KeyboardHelper.right) {
                            rightPressed = true
                        }
                        if (event.keyCode === KeyboardHelper.left) {
                            leftPressed = true
                        }
                        if (event.keyCode === KeyboardHelper.up) {
                            upPressed = true
                        }
                        if (event.keyCode === KeyboardHelper.down) {
                            downPressed = true
                        }
                });
                document.addEventListener("keyup", () => {
                        if (event.keyCode === KeyboardHelper.right) {
                            rightPressed = false
                        }
                        if (event.keyCode === KeyboardHelper.left) {
                            leftPressed = false
                        }
                        if (event.keyCode === KeyboardHelper.up) {
                            upPressed = false
                        }
                        if (event.keyCode === KeyboardHelper.down) {
                            downPressed = false
                        }
                });

                // main loop
                function step() {
                    if (rightPressed) {
                        herpooles.x += 20;
                    } else if (leftPressed) {
                        herpooles.x -= 20;
                    }
                    if (upPressed) {
                        herpooles.y -= 20;
                    } else if (downPressed) {
                        herpooles.y += 20;
                    }
                    draw(ctx, herpooles);
                    //console.log("step");
                    //window.requestAnimationFrame(step);
                }
                window.setInterval(step, 1000);
                //window.requestAnimationFrame(step);
            }

            run();
        </script>
    </body>
</html>
